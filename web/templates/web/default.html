{% extends "web/base.html" %}

{% block main %}
  <main class="default">
    <div class="col1">
      <h2>
        {% if page.title %}
          {{ page.title|safe }}
        {% elif title %}
          {{ title }}
        {% endif %}
      </h2>
      <div>{{ page.main_content|safe|linebreaks }}</div>

      {# Events & Meetings #}
      {% if request.resolver_match.url_name == 'events_meetings' %}
        <br> 
        <h3>Upcoming Forum Meetings</h3>
        {% if upcoming_meetings %}
          {% for meeting in upcoming_meetings %}
            <p class="center">
              {% if meeting.url %}
                <a href="{{ meeting.url }}">{{ meeting.date }}</a>
              {% else %}
                {{ meeting.date }}
              {% endif %}
            </p>
          {% endfor %}
        {% else %}
          <p>There are no meetings scheduled at this time. Please 
            <a href="/contact">contact the Forum</a> for initial thinking about the next regular 
            meeting date, which will be posted here once it is set.
          </p>
        {% endif %}

        {% if upcoming_events %}
          <br>
          <h3>Upcoming Events</h3> 
          {% for event in upcoming_events %}
            <p class="bold">{{ event.date }}</p> 
              {% if event.url %}
                <a href="{{event.url}}">{{event.title}}</a>
              {% else %}
                {{ event.title }}
              {% endif %}
            </p>
            {% if event.location %}
            <p>{{ event.location|safe }}</p>
            {% endif %}
            {% if event.description %}
              <p>{{ event.description|safe }}</p>
            {% endif %}
            <br>
          {% endfor %}
        {% endif %}
        <h3>Past Forum Meetings</h3>
        {% if past_meetings %}
          <table class="past_meetings" align="left">
            {% for meeting in past_meetings %}
              <tr>
                <td><b>{{meeting.year}}<b></td>
                <td>{{meeting.date|date:"M"}}</td>
                <td>
                  {% if meeting.agenda %}
                    <a href="{{ meeting.agenda.url }}" class="download">Agenda</a>
                  {% else %}
                    &nbsp;
                  {% endif %}
                </td>
                <td>
                  {% if meeting.minutes %}
                    <a href="{{ meeting.minutes.url }}" class="download">Minutes/Highlights</a>
                  {% else %}
                    &nbsp;
                  {% endif %}
                </td>
                <td>
                  {% if meeting.presentation_materials %}
                    <a href="{{ meeting.presentation_materials.url }}" class="download">
                    Presentations/Materials</a>
                  {% else %}
                    &nbsp;
                  {% endif %}
                </td>
              </tr>
            {% endfor %}
          </table>
        {% endif %}

      {# Membership #}
      {% elif request.resolver_match.url_name == 'membership' %}
        <div id="map">
          This text is hard-coded into the template in a div named "map". Marc's webmap will go here.
        </div>

      {# Search #}
      {% elif request.resolver_match.url_name == 'search' %}
        {% if not search_term %}
          {% include 'web/search_form.html' %}      
        {% endif %} 

        {% if search_attempt %}
          <h3>Results</h3>
          {% if results %}
            {% if results.pages %}
              <p class="bold center">Pages</p>
              <ul>
              {% for page in results.pages %}
                <li><a href="{% url 'web:'|add:page.internal_name %}">{{page}}</a></li>
              {% endfor %}
              </ul>
              <br>
            {% endif %}
            {% if results.events %}
              <p class="bold center">Events</p> 
              <ul> 
              {% for event in results.events %}
                <li>
                {% if event.url %}
                  <a href="{{ event.url }}">{{ event.title }}</a>
                {% else %}
                  {{ event.title }}
                {% endif %}
                - {{event.date}}
                </li>
              {% endfor %}
              </ul>
              <br>
            {% endif %}
            {% if results.tech_resources %}
              <p class="bold center">Technical Resources</p>
              <ul> 
              {% for resource in results.tech_resources %}
                  <li><a href="{{ resource.url }}">{{ resource.name }}</a>
                  - published {{ resource.publication_date }}, Source: {{ resource.source }}</li>
              {% endfor %}
              </ul>
              <br>
            {% endif %}
            {% if results.funding_resources %}
              <p class="bold center">Funding Resources</p>
              <ul>
              {% for resource in results.funding_resources %}
                <li>
                  <a href="{{ resource.url }}">{{ resource.name }}</a>
                  - due {{ resource.due_date }}, Source: {{ resource.source_name }}
                </li>
              {% endfor %}
              </ul>
              <br>
            {% endif %}

          {% else %}
            <p>No results found for your search.</p>
          {% endif %}
        {% endif %}
      {% endif %}

    </div>
    <div class="col2">
      {% if page.sidebar %}
        {{ page.sidebar|safe }}
      {% endif %}    
    </div>
  </main>
{% endblock %}
